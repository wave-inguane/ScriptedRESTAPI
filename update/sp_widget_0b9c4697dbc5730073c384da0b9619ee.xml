<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[
function($scope,$http, spUtil) {//x_snc_polls_poll.list
	/* widget controller */
	var c = this;
	var baseUrl = "";

	/*
	function parseQuery(table, queryString){
		return $http.post('/api/now/sp/parsequery/' + table, queryString).then(function(response){
				return response.data.result;
		});
	}
*/

	/*
	$http.get("productData.json").then(function (response) {
console.log("Status: " + response.status);
console.log("Type: " + response.headers("content-type"));
console.log("Length: " + response.headers("content-length"));
$scope.products = response.data;
});
	*/


	/* XML FILE
	<products>
<product name="Apples" category="Fruit" price="1.20" expiry="10" />
<product name="Bananas" category="Fruit" price="2.42" expiry="7" />
<product name="Pears" category="Fruit" price="2.02" expiry="10" />
<product name="Tuna" category="Fish" price="20.45" expiry="3" />
<product name="Salmon" category="Fish" price="17.93" expiry="2" />
<product name="Trout" category="Fish" price="12.93" expiry="4" />
</products>

<script>
angular.module("exampleApp", [])
.controller("defaultCtrl", function ($scope, $http) {
$scope.loadData = function () {
$http.get("productData.xml").then(function (response) {
$scope.products = [];
var productElems = angular.element(response.data.trim()).find("product");
for (var i = 0; i < productElems.length; i++) {
var product = productElems.eq(i);
$scope.products.push({
name: product.attr("name"),
category: product.attr("category"),
price: product.attr("price")
});
}
});
}
});
</script>


<script>
angular.module("exampleApp", [])
.controller("defaultCtrl", function ($scope, $http) {
$scope.loadData = function () {
var config = {
transformResponse: function (data, headers) {
if(headers("content-type") == "application/xml"
&& angular.isString(data)) {
products = [];
var productElems = angular.element(data.trim()).find("product");
for (var i = 0; i < productElems.length; i++) {
var product = productElems.eq(i);
products.push({
name: product.attr("name"),
category: product.attr("category"),
price: product.attr("price")
});
}
return products;
} else {
return data;
}
}
}
$http.get("productData.xml", config).success(function (data) {
$scope.products = data;
});
}
});
</script>
	*/




	//--------------------------------------------------------------------------
	// Lab 1 GET
	//--------------------------------------------------------------------------
	var currApi = '/api/x_snc_polls/hello_world';
	c.createQueryTerm = function(currApi,table, field, sys_id, operator){
		return $http.get(currApi, {
			params: {
				table: table,
				sys_id: sys_id,
				field: field,
				operator: operator
			}
		}).then(function(response){
			if (response && response.data && response.data.result)
				return response;//.data.result;
		});
	}


	var promise = c.createQueryTerm(currApi,"","","","");
	console.dir(promise);
	console.log(promise);
	//console.log(promise.statusText);
	promise.then(function(value) {
		console.log(value);
		// expected output: "Success!"
		console.log(value.status);
		//console.log(value.statusText);
		//console.log(value.data);
		//console.log(value.data.result);
	});


	//--------------------------------------------------------------------------
	// Lab 2 GET
	//--------------------------------------------------------------------------
	currApi = 'https://dev78424.service-now.com/api/x_snc_polls/v1/poll/3c265ae6134b1200ed373d62f244b0fc';
	var promise = c.createQueryTerm(currApi,"","","","");
	console.dir(promise);
	console.log(promise);
	//console.log(promise.statusText);
	promise.then(function(value) {
		console.log(value);
		// expected output: "Success!"
		console.log(value.status);
		//console.log(value.statusText);
		//console.log(value.data);
		//console.log(value.data.result);
	});



	//--------------------------------------------------------------------------
	// Lab 3 POST
	//--------------------------------------------------------------------------
	currApi = 'https://dev78424.service-now.com/api/x_snc_polls/v1/poll';
	var record = {
		"questions": [{"choices": [ { "choice": "Audi" }, { "choice": "BMW" }, {"choice": "Corvette" }, {"choice": "Tesla"}],"question": "what is your favorite car"}],
		"usergroup": "Software", 
		"name": "Client posted poll"
	};
	$http.post(currApi, record)
		.success(function (data) {
		console.log("LAB 3 POST");
		console.log(data);
	}).error(function (error) {
		$scope.postError = error;
		console.log("LAB 3 POST ERROR : "+$scope.postError);
		spUtil.addErrorMessage(	$scope.postError );
	})/*.finally(function () {
		$location.path("/complete");
	});*/



	// EDIT
	currApi = 'https://dev78424.service-now.com/api/x_snc_polls/v1/poll/94a3961fdbc5730073c384da0b961941';
	var arrPatch = [
		{
			"choices": [
				{
					"choice": "Avatar"
				},
				{
					"choice": "Avengers"
				},
				{
					"choice": "Toy Story"
				},
				{
					"choice": "Frozen"
				}
			],
			"question": "what is your favorite film"
		}
	];

	$http.patch(currApi, arrPatch)
		.success(function (data) {
		console.log("LAB 3 PATCH");
		console.log(data);
	}).error(function (error) {
		$scope.postError = error;
		spUtil.addErrorMessage(	$scope.postError );
	})
	
	$scope.updateProduct = function (product) {
		$http({
			url: baseUrl + product.id,
			method: "PUT",
			data: product
		}).success(function (modifiedProduct) {
			for (var i = 0; i < $scope.products.length; i++) {
				if ($scope.products[i].id == modifiedProduct.id) {
					$scope.products[i] = modifiedProduct;
					break;
				}
			}
			$scope.displayMode = "list";
		});
	}





	// POST
	var vote = {
		"votes": [
			{
				"vote": "Yellow",
				"question_id": "9f369ae6134b1200ed373d62f244b0d7"
			}
		]
	};

	currApi = 'https://dev78424.service-now.com/api/x_snc_polls/v1/poll/30638a9fdb85730073c384da0b961914/vote';

	$http.post(currApi, vote)
		.success(function (data) {
		console.log("LAB 3.1 POST");
		console.log(data);
	}).error(function (error) {
		$scope.postError = error;
		spUtil.addErrorMessage(	$scope.postError );
	})
	
	
	$scope.createProduct = function (product) {
		$http.post(baseUrl, product).success(function (newProduct) {
			$scope.products.push(newProduct);
			$scope.displayMode = "list";
		});
	}

	// DELETE
	$scope.deleteProduct = function (product) {
		$http({
			method: "DELETE",
			url: baseUrl + product.id
		}).success(function () {
			$scope.products.splice($scope.products.indexOf(product), 1);
		});
	}
	
	
	
	
	
	/*
	var billMe = {
			"TransactionAmount": "20.00m",
                    "AccountNumber": "5555555555555557",
                    "CreditCardExpirationDate": "2020-10",
                    "FirstName": "Leonid",
                    "MiddleInitial": "",
                    "LastName": "Gaiazov",
                    "CardSecurityCode": "111",
                    "BillingAddress": "123 Test Street",
                    "BillingAddress2": "Apt 10",
                    "BillingCity": "City",
                    "BillingState": "VA",
                    "BillingZip": "20001",
                    "BillingCountry": "840",
                    "AccountHolderEmailAddress": "test@test.com"
	};
	
  currApi = 'https://tcs.pay.gov/tcscollections/services/TCSSingleService';
	$http.post(currApi, billMe)
		.success(function (data) {
		console.log("PayGov POST");
		console.log(data);
	}).error(function (error) {
		$scope.postError = error;
		spUtil.addErrorMessage(	$scope.postError );
	})

	*/
}]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>polls_rest_api</id>
        <internal>false</internal>
        <link/>
        <name>Polls Rest APi</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {//x_snc_polls_poll
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */

	//--------------------------------------------------------------------------
	// Lab 1 : GET
	//--------------------------------------------------------------------------
	var request = new sn_ws.RESTMessageV2();
	request.setEndpoint('https://dev78424.service-now.com/api/x_snc_polls/hello_world');
	request.setHttpMethod('GET');

	//Eg. UserName="admin", Password="admin" for this code sample.
	var user = 'admin';
	var password = gs.getProperty("x_snc_polls.postman");

	request.setBasicAuth(user,password);
	request.setRequestHeader("Accept","application/json");

	var response = request.execute();
	gs.addInfoMessage("GET : "+response.getBody());

	//data.list = [];
	//data.list.push(response.getBody());
	gs.addInfoMessage("");




	//--------------------------------------------------------------------------
	// Lab 2 GET
	//--------------------------------------------------------------------------
	var request = new sn_ws.RESTMessageV2();
	request.setEndpoint('https://dev78424.service-now.com/api/x_snc_polls/v1/poll/3c265ae6134b1200ed373d62f244b0fc');
	request.setHttpMethod('GET');

	//Eg. UserName="admin", Password="admin" for this code sample.
	var user = 'admin';
	var password = gs.getProperty("x_snc_polls.postman");

	request.setBasicAuth(user,password);
	request.setRequestHeader("Accept","application/json");

	var response = request.execute();
	//gs.addInfoMessage("GET : "+response.getBody());



	//--------------------------------------------------------------------------
	// Lab 3 POST
	//--------------------------------------------------------------------------
	var record = {
		"questions": [{"choices": [ { "choice": "Audi" }, { "choice": "BMW" }, {"choice": "Corvette" }, {"choice": "Tesla"}],"question": "what is your favorite car"}],
		"usergroup": "Software", 
		"name": "Client posted poll"
	};

	var request = new sn_ws.RESTMessageV2();
	request.setEndpoint('https://dev78424.service-now.com/api/x_snc_polls/v1/poll');
	request.setHttpMethod('POST');

	//Eg. UserName="admin", Password="admin" for this code sample.
	var user = 'admin';
	var password = gs.getProperty("x_snc_polls.postman");

	request.setBasicAuth(user,password);
	request.setRequestHeader("Accept","application/json");
	request.setRequestHeader('Content-Type','application/json');
	//request.setRequestBody("{\"questions\": [{\"choices\": [ { \"choice\": \"Audi\" },{ \"choice\": \"BMW\" }, {\"choice\": \"Corvette\" }, {\"choice\": \"Tesla\"}],\"question\": \"what is your favorite car\"}],\"usergroup\": \"Software\", \"name\": \"Fourth poll\" }");
	request.setRequestBody(JSON.stringify(record));
	var response = request.execute();
	gs.addInfoMessage("POSTED : "+response.getBody());


	// EDIT 
	var request = new sn_ws.RESTMessageV2();
	request.setEndpoint('https://dev78424.service-now.com/api/x_snc_polls/v1/poll/94a3961fdbc5730073c384da0b961941');
	request.setHttpMethod('PATCH');

	//Eg. UserName="admin", Password="admin" for this code sample.
	var user = 'admin';
	var password = gs.getProperty("x_snc_polls.postman");

	request.setBasicAuth(user,password);
	request.setRequestHeader("Accept","application/json");
	request.setRequestHeader('Content-Type','application/json');
	request.setRequestBody("[{\"choices\": [{\"choice\": \"Avatar\"},{\"choice\": \"Avengers\"},{\"choice\": \"Toy Story\"},{\"choice\": \"Frozen\"}],\"question\": \"what is your favorite film\"  }]");
	//var response = request.execute();
	//gs.addInfoMessage("PACHED : "+response.getBody());

	var response = request.execute();
	gs.addInfoMessage("PATCHED : "+response.getBody() + " " + response.getStatusCode());


	
	

	// POST
	var request = new sn_ws.RESTMessageV2();
	request.setEndpoint('https://dev78424.service-now.com/api/x_snc_polls/v1/poll/30638a9fdb85730073c384da0b961914/vote');
	request.setHttpMethod('POST');

	//Eg. UserName="admin", Password="admin" for this code sample.
	var user = 'admin';
	var password = gs.getProperty("x_snc_polls.postman");

	request.setBasicAuth(user,password);
	request.setRequestHeader("Accept","application/json");
	request.setRequestHeader('Content-Type','application/json');
	request.setRequestBody("{\"votes\": [{\"vote\": \"Yellow\",\"question_id\": \"9f369ae6134b1200ed373d62f244b0d7\"}]}");
	var response = request.execute();
	gs.addInfoMessage("POSTED : "+response.getBody());
	
	
	
	// DELETE
	var request = new sn_ws.RESTMessageV2();
	request.setEndpoint('https://dev78424.service-now.com/api/x_snc_polls/v1/poll/3b3bda63db41b30073c384da0b961902');
	request.setHttpMethod('DELETE');

	//Eg. UserName="admin", Password="admin" for this code sample.
	var user = 'admin';
	var password = gs.getProperty("x_snc_polls.postman");

	request.setBasicAuth(user,password);
	request.setRequestHeader("Accept","application/json");

	var response = request.execute();
	//204 ok 203 record not found
	gs.addInfoMessage("DELETE : "+response.getBody() + " " +response.getStatusCode() );
	
	
	
		var billMe = {
			"TransactionAmount": "20.00m",
                    "AccountNumber": "5555555555555557",
                    "CreditCardExpirationDate": "2020-10",
                    "FirstName": "Leonid",
                    "MiddleInitial": "",
                    "LastName": "Gaiazov",
                    "CardSecurityCode": "111",
                    "BillingAddress": "123 Test Street",
                    "BillingAddress2": "Apt 10",
                    "BillingCity": "City",
                    "BillingState": "VA",
                    "BillingZip": "20001",
                    "BillingCountry": "840",
                    "AccountHolderEmailAddress": "test@test.com"
	};
	
	
	var request = new sn_ws.RESTMessageV2();
	request.setEndpoint('https://tcs.pay.gov/tcscollections/services/TCSSingleService');
	request.setHttpMethod('POST');

	//Eg. UserName="admin", Password="admin" for this code sample.
//	var user = 'admin';
//	var password = gs.getProperty("x_snc_polls.postman");

//	request.setBasicAuth(user,password);
	request.setRequestHeader("Accept","application/json");
	request.setRequestHeader('Content-Type','application/json');
	//request.setRequestBody("{\"questions\": [{\"choices\": [ { \"choice\": \"Audi\" },{ \"choice\": \"BMW\" }, {\"choice\": \"Corvette\" }, {\"choice\": \"Tesla\"}],\"question\": \"what is your favorite car\"}],\"usergroup\": \"Software\", \"name\": \"Fourth poll\" }");
	request.setRequestBody(JSON.stringify(billMe));
	var response = request.execute();
	gs.addInfoMessage("POSTED PayGov : "+response.getBody());
	
	
	
	
	
	
	
	

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-05-01 20:24:41</sys_created_on>
        <sys_id>0b9c4697dbc5730073c384da0b9619ee</sys_id>
        <sys_mod_count>27</sys_mod_count>
        <sys_name>Polls Rest APi</sys_name>
        <sys_package display_value="Polls" source="x_snc_polls">cd1f2766133e1200ed373d62f244b082</sys_package>
        <sys_policy/>
        <sys_scope display_value="Polls">cd1f2766133e1200ed373d62f244b082</sys_scope>
        <sys_update_name>sp_widget_0b9c4697dbc5730073c384da0b9619ee</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-05-22 10:50:56</sys_updated_on>
        <template><![CDATA[<div><!-- your widget template --></div>]]></template>
    </sp_widget>
</record_update>
