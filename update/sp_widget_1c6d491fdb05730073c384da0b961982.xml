<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope,$http, spUtil) {
	/* widget controller */
	var c = this;

	/*
	function parseQuery(table, queryString){
		return $http.post('/api/now/sp/parsequery/' + table, queryString).then(function(response){
				return response.data.result;
		});
	}
*/

	//--------------------------------------------------------------------------
	// Lab 1 GET
	//--------------------------------------------------------------------------
	var currApi = '/api/x_snc_polls/hello_world';
	c.createQueryTerm = function(currApi,table, field, sys_id, operator){
		return $http.get(currApi, {
			params: {
				table: table,
				sys_id: sys_id,
				field: field,
				operator: operator
			}
		}).then(function(response){
			if (response && response.data && response.data.result)
				return response;//.data.result;
		});
	}


	var promise = c.createQueryTerm(currApi,"","","","");
	console.dir(promise);
	console.log(promise);
	//console.log(promise.statusText);
	promise.then(function(value) {
		console.log(value);
		// expected output: "Success!"
		console.log(value.status);
		//console.log(value.statusText);
		//console.log(value.data);
		//console.log(value.data.result);
	});


	//--------------------------------------------------------------------------
	// Lab 2 GET
	//--------------------------------------------------------------------------
	currApi = 'https://dev78424.service-now.com/api/x_snc_polls/v1/poll/3c265ae6134b1200ed373d62f244b0fc';
	var promise = c.createQueryTerm(currApi,"","","","");
	console.dir(promise);
	console.log(promise);
	//console.log(promise.statusText);
	promise.then(function(value) {
		console.log(value);
		// expected output: "Success!"
		console.log(value.status);
		//console.log(value.statusText);
		//console.log(value.data);
		//console.log(value.data.result);
	});



	//--------------------------------------------------------------------------
	// Lab 3 POST
	//--------------------------------------------------------------------------
	currApi = 'https://dev78424.service-now.com/api/x_snc_polls/v1/poll';
	var record = {
		"questions": [{"choices": [ { "choice": "Audi" }, { "choice": "BMW" }, {"choice": "Corvette" }, {"choice": "Tesla"}],"question": "what is your favorite car"}],
		"usergroup": "Software", 
		"name": "Client posted poll"
	};
	$http.post(currApi, record)
		.success(function (data) {
				console.log("LAB 3 POST");
				console.log(data);
	}).error(function (error) {
			$scope.postError = error;
			spUtil.addErrorMessage(	$scope.postError );
	})/*.finally(function () {
		$location.path("/complete");
	});*/

}

















]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>polls_rest_api</id>
        <internal>false</internal>
        <link/>
        <name>Polls Rest APi</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */

	//--------------------------------------------------------------------------
	// Lab 1 : GET
	//--------------------------------------------------------------------------
	var request = new sn_ws.RESTMessageV2();
	request.setEndpoint('https://dev78424.service-now.com/api/x_snc_polls/hello_world');
	request.setHttpMethod('GET');

	//Eg. UserName="admin", Password="admin" for this code sample.
	var user = 'admin';
	var password = gs.getProperty("x_snc_polls.postman");

	request.setBasicAuth(user,password);
	request.setRequestHeader("Accept","application/json");

	var response = request.execute();
	gs.addInfoMessage(response.getBody());

	//data.list = [];
	//data.list.push(response.getBody());
	gs.addInfoMessage("");




	//--------------------------------------------------------------------------
	// Lab 2 GET
	//--------------------------------------------------------------------------
	var request = new sn_ws.RESTMessageV2();
	request.setEndpoint('https://dev78424.service-now.com/api/x_snc_polls/v1/poll/3c265ae6134b1200ed373d62f244b0fc');
	request.setHttpMethod('GET');

	//Eg. UserName="admin", Password="admin" for this code sample.
	var user = 'admin';
	var password = gs.getProperty("x_snc_polls.postman");

	request.setBasicAuth(user,password);
	request.setRequestHeader("Accept","application/json");

	var response = request.execute();
	gs.addInfoMessage(response.getBody());



	//--------------------------------------------------------------------------
	// Lab 3 POST
	//--------------------------------------------------------------------------
		var record = {
		"questions": [{"choices": [ { "choice": "Audi" }, { "choice": "BMW" }, {"choice": "Corvette" }, {"choice": "Tesla"}],"question": "what is your favorite car"}],
		"usergroup": "Software", 
		"name": "Client posted poll"
	};
	
	var request = new sn_ws.RESTMessageV2();
	request.setEndpoint('https://dev78424.service-now.com/api/x_snc_polls/v1/poll');
	request.setHttpMethod('POST');

	//Eg. UserName="admin", Password="admin" for this code sample.
	var user = 'admin';
	var password = gs.getProperty("x_snc_polls.postman");

	request.setBasicAuth(user,password);
	request.setRequestHeader("Accept","application/json");
	request.setRequestHeader('Content-Type','application/json');
	//request.setRequestBody("{\"questions\": [{\"choices\": [ { \"choice\": \"Audi\" },{ \"choice\": \"BMW\" }, {\"choice\": \"Corvette\" }, {\"choice\": \"Tesla\"}],\"question\": \"what is your favorite car\"}],\"usergroup\": \"Software\", \"name\": \"Fourth poll\" }");
	request.setRequestBody(JSON.stringify(record));
	var response = request.execute();
	gs.addInfoMessage(response.getBody());



})();












]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-05-01 15:48:25</sys_created_on>
        <sys_id>1c6d491fdb05730073c384da0b961982</sys_id>
        <sys_mod_count>21</sys_mod_count>
        <sys_name>Polls Rest APi</sys_name>
        <sys_package display_value="Polls" source="x_snc_polls">cd1f2766133e1200ed373d62f244b082</sys_package>
        <sys_policy/>
        <sys_scope display_value="Polls">cd1f2766133e1200ed373d62f244b082</sys_scope>
        <sys_update_name>sp_widget_1c6d491fdb05730073c384da0b961982</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-05-01 18:18:55</sys_updated_on>
        <template><![CDATA[<div><!-- your widget template --></div>]]></template>
    </sp_widget>
</record_update>
